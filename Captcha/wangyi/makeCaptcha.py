import random

import cv2
import numpy as np


class CaptchaGenerator:
    def __init__(self):
        self.roi_pos= [
        [[0, 80, 0, 80], [0, 80, 80, 160, ]],
        [[0, 80, 0, 80], [0, 80, 160, 240, ]],
        [[0, 80, 0, 80], [0, 80, 240, 320, ]],
        [[0, 80, 0, 80], [80, 160, 0, 80, ]],
        [[0, 80, 0, 80], [80, 160, 80, 160, ]],
        [[0, 80, 0, 80], [80, 160, 160, 240, ]],
        [[0, 80, 0, 80], [80, 160, 240, 320, ]],
        [[0, 80, 80, 160, ], [0, 80, 160, 240, ]],
        [[0, 80, 80, 160, ], [0, 80, 240, 320, ]],
        [[0, 80, 80, 160, ], [80, 160, 0, 80, ]],
        [[0, 80, 80, 160, ], [80, 160, 80, 160, ]],
        [[0, 80, 80, 160, ], [80, 160, 160, 240, ]],
        [[0, 80, 80, 160, ], [80, 160, 240, 320, ]],
        [[0, 80, 160, 240, ], [0, 80, 240, 320, ]],
        [[0, 80, 160, 240, ], [80, 160, 0, 80, ]],
        [[0, 80, 160, 240, ], [80, 160, 80, 160, ]],
        [[0, 80, 160, 240, ], [80, 160, 160, 240, ]],
        [[0, 80, 160, 240, ], [80, 160, 240, 320, ]],
        [[0, 80, 240, 320, ], [80, 160, 0, 80, ]],
        [[0, 80, 240, 320, ], [80, 160, 80, 160, ]],
        [[0, 80, 240, 320, ], [80, 160, 160, 240, ]],
        [[0, 80, 240, 320, ], [80, 160, 240, 320, ]],
        [[80, 160, 0, 80, ], [80, 160, 80, 160, ]],
        [[80, 160, 0, 80, ], [80, 160, 160, 240, ]],
        [[80, 160, 0, 80, ], [80, 160, 240, 320, ]],
        [[80, 160, 80, 160, ], [80, 160, 160, 240, ]],
        [[80, 160, 80, 160, ], [80, 160, 240, 320, ]],
        [[80, 160, 160, 240, ], [80, 160, 240, 320, ]],
        ]
    def genImg(self,img):
        img = cv2.resize(img, (320, 160))

        img = img.astype(np.float64)
        for r in range(2):
            for c in range(4):
                if np.random.random()<0.3:
                    img[80*r:80*(r+1),80*c:80*(c+1),: ] *= 0.7
        img = img.astype(np.uint8)
        index = random.randint(0, 27)
        swap_info = self.roi_pos[index]
        temp = img[swap_info[0][0]:swap_info[0][1],swap_info[0][2]:swap_info[0][3], :].copy()
        # 第一块和第二块交换
        img[swap_info[0][0]:swap_info[0][1],swap_info[0][2]:swap_info[0][3], :] = img[swap_info[1][0]:swap_info[1][1],swap_info[1][2]:swap_info[1][3], :]
        img[swap_info[1][0]:swap_info[1][1],swap_info[1][2]:swap_info[1][3], :] = temp
        return img,index

if __name__ == '__main__':
    img= cv2.imread('dataset/fj.jpg')
    cg = CaptchaGenerator()
    img,index = cg.genImg(img)
    cv2.imshow('img',img)
    cv2.waitKey(0)
